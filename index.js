!function(){"use strict";const e="EQBVonIf1eYcqc3gCd8iXjvCPkbuBWjsyVwSY0-fHEHM6HmC";let t="https://toncenter.com/api/v2/jsonRPC",n="",o="";document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("currentYear").innerHTML=Number((new Date).getFullYear()).toString(),u()?c(!0):i(t);document.getElementById("increment").onclick=async()=>{if(""==n)return void l("Please, connect your wallet");if(await a(["ton_sendRawTransaction","ton_subscribe","ton_unsubscribe"])){let t;try{t=await window.ton.request({method:"ton_sendRawTransaction",params:{to:e,amount:.01,data:"te6ccsEBAQEABgAGAAgAAAABOYxhGg==",dataType:"boc",stateInit:""}}),t&&(l("Wait for the transaction to be confirmed on the TON blockchain."),await r(n.address),l("Your transaction is confirmed on TON blockchain!"),i(o))}catch(e){console.log(e),l(e.message),i(o)}}else l("We need some action from your side to provide our service. Please confirm required permissions.")};document.getElementById("connect_wallet").onclick=async()=>{u()?c():l("Please use wallet with TEPs105 compatibilty, for example <a target='_blank' href='https://chrome.google.com/webstore/detail/xton-wallet/cjookpbkjnpkmknedggeecikaponcalb'>XTON wallet</a>.")};document.getElementById("modal-close").onclick=m,document.addEventListener("keydown",(e=>{"Escape"===e.key&&m()}))}));const s=e=>`${e.substr(0,4)}...${e.substr(-4,4)}`,a=async e=>{const t=await window.ton.request({method:"wallet_getPermissions",params:{}});let n=e.filter((e=>t.includes(e)));if(n.length!=e.length)try{const o=e.filter((e=>!t.includes(e))),s=await window.ton.request({method:"wallet_requestPermissions",params:{permissions:o}});if(n=o.filter((e=>s.includes(e))),n.length!=o.length)return!1}catch(e){return!1}return!0},r=async e=>new Promise(((t,n)=>{const o=setTimeout((()=>{n(new Error("Timeout for the confirmation, please check in the blockchain explorer"))}),6e4);window.ton.request({method:"ton_subscribe",params:{address:e}}).then((n=>{window.ton.on("message",(s=>{"ton_subscription"===s.type&&s.subscriptionId===n&&(clearTimeout(o),window.ton.request({method:"ton_unsubscribe",params:{address:e}}),t(s.data))}))})).catch((e=>{clearTimeout(o),console.error(`Error making events subscription: ${e.message}.\n                    Code: ${e.code}. Data: ${e.data}`),n(e)}))})),i=n=>{let o;if("mainnet"===n)o=t;else o="https://testnet.toncenter.com/api/v2/jsonRPC";(async(e,t,n)=>{let o={"Content-Type":"application/json"},s=JSON.stringify({id:"1",jsonrpc:"2.0",method:"runGetMethod",params:{address:t,method:n,stack:[]}});try{let t=await fetch(e,{method:"POST",headers:o,body:s});const n=await t.json();return!!n.ok&&n.result.stack}catch(e){return console.log(e),!1}})(o,e,"get_total").then((e=>{if(!1!==e){document.getElementById("get_total").innerHTML=Number(e[0][1]).toString()}else get_total.innerHTML="?",l("Something has gone really wrong. Please reload this page. This issue can be related to the rate limit on TONCENTER API endpoint. To avoid this in the future, the developer can use API_KEY.")}))},c=async(e=!1)=>{if(window.ton.off("accountChanged"),window.ton.on("accountChanged",(function(e){n!=e&&(n=e,c())})),window.ton.off("endpointChanged"),window.ton.on("endpointChanged",(function(e){console.log(o,e,o!=e),o!=e&&(o=e,c())})),e)try{n=await window.ton.request({method:"ton_account",params:{}}),o=await window.ton.request({method:"ton_endpoint",params:{}}),d(n,o),i(o)}catch(e){console.log(e.message),i("mainnet")}else{if(await a(["ton_account","ton_endpoint"]))try{n=await window.ton.request({method:"ton_account",params:{}}),o=await window.ton.request({method:"ton_endpoint",params:{}}),d(n,o),i(o)}catch(e){l(e.message)}else l("We need some action from your side to provide our service. Please confirm required permissions.")}},d=(e,t)=>{const n=document.getElementById("connect_wallet");n.classList.remove("primary"),n.innerText="Connected";const o=document.getElementById("wallet_address");switch(t){case"mainnet":o.innerHTML=`<a target="_blank" rel="noopener noreferrer" href="https://tonscan.org/address/${e.address}">${s(e.address)}</a> your balance is ~${Number(e.balance/10**9).toFixed(2)}`;break;case"testnet":o.innerHTML=`<a target="_blank" rel="noopener noreferrer" href="https://testnet.tonscan.org/address/${e.address}">${s(e.address)}</a> your balance is ~${Number(e.balance/10**9).toFixed(2)}`;break;default:l("We don't support this endpoint")}},l=e=>{const t=document.getElementById("modal"),n=document.getElementById("modal-content");n.innerHTML=e,t.classList.add("visible"),n.classList.add("visible")},m=()=>{const e=document.getElementById("modal"),t=document.getElementById("modal-content");e.classList.remove("visible"),t.classList.remove("visible")},u=()=>void 0!==window.ton&&window.ton.isTEPs105}();
